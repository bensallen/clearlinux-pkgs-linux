From 732c75ee2f6ac9c624cad05204b5a5e3859e4b13 Mon Sep 17 00:00:00 2001
From: Miguel Bernal Marin <miguel.bernal.marin@linux.intel.com>
Date: Tue, 23 Jun 2015 03:02:13 -0500
Subject: [PATCH 2/2] dpdk: remove rebuild from header_ops

Please refer to:
https://www.marc.info/?l=linux-netdev&m=142527617111413&w=3

and linux commit d476059e77d1af48453a58f9de1e36f2eaff6450

Signed-off-by: Miguel Bernal Marin <miguel.bernal.marin@linux.intel.com>
---
 drivers/net/dpdk/kni/kni_net.c | 26 ++++++++++++++------------
 1 file changed, 14 insertions(+), 12 deletions(-)

diff --git a/drivers/net/dpdk/kni/kni_net.c b/drivers/net/dpdk/kni/kni_net.c
index ee0c5b2..0f3d4c7 100644
--- a/drivers/net/dpdk/kni/kni_net.c
+++ b/drivers/net/dpdk/kni/kni_net.c
@@ -600,20 +600,21 @@ kni_net_header(struct sk_buff *skb, struct net_device *dev,
 }
 
 
+// TODO: find other way to rebuild
 /*
  * Re-fill the eth header
  */
-static int
-kni_net_rebuild_header(struct sk_buff *skb)
-{
-	struct net_device *dev = skb->dev;
-	struct ethhdr *eth = (struct ethhdr *) skb->data;
-
-	memcpy(eth->h_source, dev->dev_addr, dev->addr_len);
-	memcpy(eth->h_dest, dev->dev_addr, dev->addr_len);
-
-	return 0;
-}
+//static int
+//kni_net_rebuild_header(struct sk_buff *skb)
+//{
+//	struct net_device *dev = skb->dev;
+//	struct ethhdr *eth = (struct ethhdr *) skb->data;
+//
+//	memcpy(eth->h_source, dev->dev_addr, dev->addr_len);
+//	memcpy(eth->h_dest, dev->dev_addr, dev->addr_len);
+//
+//	return 0;
+//}
 
 /**
  * kni_net_set_mac - Change the Ethernet Address of the KNI NIC
@@ -633,7 +634,8 @@ static int kni_net_set_mac(struct net_device *netdev, void *p)
 
 static const struct header_ops kni_net_header_ops = {
 	.create  = kni_net_header,
-	.rebuild = kni_net_rebuild_header,
+	// TODO: find other way to rebuild
+	//.rebuild = kni_net_rebuild_header,
 	.cache   = NULL,  /* disable caching */
 };
 
-- 
2.4.4

